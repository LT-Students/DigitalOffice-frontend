<div class="employee-info regular_text text_dark_1">

  <ng-container *ngIf='!canEdit() || !isEditing; else editForm'>

    <div class='employee-info__wrapper'>
      <div class='employee-info__main'>
        <div class='employee-info__photo' (click)='onOpenDialog()'>
          <img [src]='employee?.photoUrl' alt='Employee photo' width='200' />
        </div>
        <h3 class='employee-info__name' doText color='dark_2'>
          {{ fullName }}&nbsp;<span
            matTooltipClass='tooltip'
            [matTooltip]="employee.firstName + ' ' + (employee.status.statusInRussian | lowercase)"
            [matTooltipPosition]="'above'"
        >{{ employee?.status?.emojiIcon }}</span></h3>
        <p *ngIf='employee.about' doText color='gray' class='employee-info__about'>“{{ employee.about }}”</p>
      </div>
      <div class='employee-info__general'>
        <h4 doText color='dark_2'>Общие сведения</h4>
        <div class='employee-info__columns'>
          <div class='employee-info__first-column'>
            <div>
              <p doText regularTextSize='small' color='gray'>Должность</p>
              <p doText>{{ employee.jobPosition }}</p>
            </div>
            <div>
              <p doText regularTextSize='small' color='gray'>Департамент</p>
              <p doText>{{ employee.department }}</p>
            </div>
            <div>
              <p doText regularTextSize='small' color='gray'>Местоположение</p>
              <p doText>{{ employee.location }}</p>
            </div>
            <div>
              <p doText regularTextSize='small' color='gray'>Офис</p>
              <p doText>{{ employee.office }}</p>
            </div>
          </div>
          <div class='employee-info__second-column'>
            <p doText regularTextSize='small' color='gray'>Ставка</p>
            <div doText>{{ employee.workingRate }}</div>
            <p doText regularTextSize='small' color='gray'>
              Рабочие часы
              <mat-icon
                  class='employee-info__hint'
                  aria-label='Hint'
                  matTooltipClass='tooltip'
                  matTooltip='Рабочие часы пользователя по вашему часовому поясу'
                  matTooltipPosition='above'
              >help_outline
              </mat-icon>
            </p>
            <div>{{ workingHours }}</div>
            <div>
              <p doText regularTextSize='small' color='gray'>В компании с</p>
              <p doText>{{ employee?.workingSince | date: dateType.FULL }}</p>
            </div>
            <div>
              <p doText regularTextSize='small' color='gray'>Дата рождения</p>
              <p doText>{{ employee?.birthDate | date: dateType.FULL }}</p>
            </div>
            <ng-container *ngIf='employee.status.statusType === userStatus.Vacation'>
              <div>
                <p doText regularTextSize='small' color='gray'>В отпуске с</p>
                <p doText>{{ employee?.vacationSince | date: dateType.FULL }}</p>
              </div>
              <div>
                <p doText regularTextSize='small' color='gray'>В отпуске до</p>
                <p doText>{{ employee?.vacationUntil | date: dateType.FULL }}</p>
              </div>
            </ng-container>
            <ng-template *ngIf='employee.status.statusType === userStatus.Sick'>
              <div>
                <p doText regularTextSize='small' color='gray'>На больничном с</p>
                <p doText>{{ employee?.sickSince | date: dateType.FULL }}</p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
      <div class='employee-info__additional '>
        <div class='additional__line bg-light_3'></div>
        <div class='form__column'>
          <h4 doText color='dark_2'>Контакты</h4>
          <div>
            <p doText regularTextSize='small' color='gray'>E-mail</p>
            <div doText>{{ employee?.email }}</div>
          </div>
          <div>
            <p doText regularTextSize='small' color='gray'>Рабочий номер</p>
            <div doText>{{ employee?.phone }}</div>
          </div>
          <div>
            <p doText regularTextSize='small' color='gray'>Telegram</p>
            <div doText>{{ employee?.telegram }}</div>
          </div>
          <h4 doText color='dark_2'>
            Отпуск
            <mat-icon
                class='employee-info__hint text-gray'
                aria-label='Hint'
                aria-label='Hint'
                matTooltipClass='tooltip'
                matTooltip='Стандартный отпуск - 20 рабочих дней в год'
                matTooltipPosition='above'
            >help_outline
            </mat-icon
            >
          </h4>
          <div>
            <p doText regularTextSize='small' color='gray'>Осталось отпускных дней</p>
            <div doText>{{ employee?.vacationDaysLeft }}</div>
          </div>
        </div>
      </div>
      <div class='employee-info__edit-button'>
        <button
            type='button'
            mat-icon-button
            aria-label='Edit employee info'
            (click)='toggleEditMode()'
        ><img src='../../../../../assets/svg/edit.svg' alt='Edit' />
        </button>
      </div>
    </div>
  </ng-container>
</div>

<ng-template #nameEdit [formGroup]="employeeInfoForm">
  <do-input
    controlName="lastName"
    [isEdit]="isEditing"
    label="Фамилия"
    textSize='small'
    required="true"
  ></do-input>
  <do-input
    controlName="firstName"
    [isEdit]="isEditing"
    label="Имя"
    textSize='small'
    required="true"
  ></do-input>
  <do-input
    controlName="middleName"
    [isEdit]="isEditing"
    label="Отчество"
    textSize='small'
    required="true"
  ></do-input>
</ng-template>

<ng-template #about [formGroup]="employeeInfoForm">
  <ng-container *ngIf="!employee.isAdmin">
    <label
      class="small_text text-gray employee-info__label employee-info__label_for_textarea"
      for="about"
      ><span>О себе</span
      ><span>{{ employeeInfoForm.get('about').value.length }}/150</span></label
    >
    <mat-form-field class="employee-info__form-field" appearance="none">
      <textarea
        id="about"
        formControlName="about"
        matInput
        class="bg-light_2 employee-info__input"
        placeholder="Напишите немного о себе или оставьте заметку коллегам"
        maxlength="150"
        cdkTextareaAutosize="true"
        textSize='small'
      ></textarea>
    </mat-form-field>
  </ng-container>
</ng-template>

<ng-template #stepper [formGroup]="employeeInfoForm">
  <mat-form-field
    class="employee-info__form-field mat-form-field__stepper"
    appearance="fill"
  >
    <mat-label doText color='gray' regularTextSize='small'>Ставка</mat-label>
    <button
      class="employee-info__stepper-button h2"
      mat-icon-button
      matPrefix
      type="button"
      (click)="changeWorkingRate(-0.25)"
      [disabled]="rate.value === '0'"
    >
      -
    </button>
    <input
      #rate
      id="workingRate"
      formControlName="workingRate"
      matInput
      class="bg-light_2 employee-info__input"
      type="number"
      readonly
      required
    />
    <button
      class="employee-info__stepper-button h2"
      mat-icon-button
      matSuffix
      type="button"
      (click)="changeWorkingRate(0.25)"
      [disabled]="rate.value === '1'"
    >
      +
    </button>
  </mat-form-field>
</ng-template>

<ng-template #hours [formGroup]="employeeInfoForm">
  <div
      style='display: flex; align-items: flex-start;'
      formGroupName="workingHours"
       matTooltipClass="tooltip"
       matTooltip="Рабочие часы пользователя по вашему часовому поясу"
       [matTooltipPosition]="'above'">
    <mat-form-field
      class="mat-form-field_default-select employee-info__form-field employee-info__working-hours"
      appearance="fill"
    >
      <mat-label doText color='gray' regularTextSize='small'>
        Рабочие часы
        <mat-icon
            class="employee-info__hint"
            aria-label="Hint"
        >help_outline</mat-icon
        ></mat-label>
      <mat-select
        class="employee-info__input"
        id="startAt"
        formControlName="startAt"
      >
        <mat-option
          class="employee-info__input"
          *ngFor="let option of selectOptions.workingHours"
          [value]="option"
        >
          {{ option }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <div style='align-self: center;'>—</div>
    <mat-form-field
      class="mat-form-field_default-select employee-info__form-field employee-info__working-hours"
      appearance="none"
    >
      <mat-select class="employee-info__input" formControlName="endAt">
        <mat-option
          class="employee-info__input"
          *ngFor="let option of selectOptions.workingHours"
          [value]="option"
        >
          {{ option }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</ng-template>

<ng-template #photo [formGroup]="employeeInfoForm">
  <img [src]="previewPhoto" alt="Employee photo" width="200" />
  <label
    class="text_white employee-info__label employee-info__upload-button"
    for="photo"
    ><mat-icon class="employee-info__upload-icon">
      <img src='../../../../../assets/svg/arrow-upload-file.svg' alt="Upload photo" />
    </mat-icon>
    Обновить фото</label
  >
  <input
    id="photo"
    type="file"
    formGroupName="photo"
    (change)="onFileChange($event)"
    hidden
  />
</ng-template>

<ng-template #emoji [formGroup]="employeeInfoForm">

  <mat-form-field
    class="employee-info__form-field mat-form-field_default-select"
    appearance="fill"
    matTooltipClass="tooltip"
    matTooltip="Статус будет отображаться рядом с именем пользователя"
    [matTooltipPosition]="'above'"
  >
    <mat-label doText color='gray' regularTextSize='small' class="employee-info__label" for="status">
      Эмодзи-статус
      <mat-icon
          class="employee-info__hint"
      >help_outline</mat-icon
      >
    </mat-label>
    <mat-select
      class="employee-info__input"
      id="status"
      formControlName="status"
      [compareWith]="compareEmoji"
      appearance="fill"
    >
      <mat-option
        class="employee-info__input"
        *ngFor="let option of selectOptions.statuses"
        [value]="option.statusType"
      >
        {{ option.emojiIcon }} {{ option.statusInRussian | titlecase }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <ng-container *ngIf="isEditing && employeeInfoForm.get('status').value === userStatus.Vacation">
    <label class="small_text text-gray">Замещает: </label>
    <span class="small_text text-gray employee-info__substitute"
    >Назначить замещающего</span>
  </ng-container>
</ng-template>

<ng-template #editForm>
  <form
      class="employee-info__form"
      [formGroup]="employeeInfoForm"
      (ngSubmit)="onSubmit()"
  ><div class='employee-info__wrapper'>
    <div class='employee-info__main'>
      <div class='employee-info__photo'>
        <img [src]='previewPhoto' alt='Employee photo' width='200' />
        <label
            class='text_white employee-info__label employee-info__upload-button'
            for='photo'
        >
          <mat-icon class='employee-info__upload-icon'>
            <img src='../../../../../assets/svg/arrow-upload-file.svg' alt='Upload photo' />
          </mat-icon>
          Обновить фото</label
        >
        <input
            id='photo'
            type='file'
            formGroupName='photo'
            (change)='onFileChange($event)'
            hidden />
      </div>
      <ng-container *ngIf='!employee.isAdmin; else nameEdit'>
        <h3 class='employee-info__name' doText color='dark_2'>
          {{ fullName }}&nbsp;<span
            matTooltipClass='tooltip'
            [matTooltip]="employee.firstName + ' ' + (employee.status.statusInRussian | lowercase)"
            [matTooltipPosition]="'above'"
        >{{ employee.status.emojiIcon }}</span>
        </h3>
      </ng-container>
      <ng-container *ngTemplateOutlet='about'></ng-container>
    </div>
    <div class='employee-info__general'>
      <h4 doText color='dark_2'>Общие сведения</h4>
      <div class='employee-info__columns'>
        <div class='employee-info__first-column'>
          <do-select
              controlName='jobPosition'
              [isEdit]='employee.isAdmin'
              [options]='selectOptions.jobPosition'
              label='Должность'
              textSize='small'
              required='true'
          ></do-select>
          <do-select
              controlName='department'
              [isEdit]='employee.isAdmin'
              [options]='selectOptions.department'
              label='Департамент'
              textSize='small'
              required='true'
          ></do-select>
          <do-input
              controlName='location'
              [isEdit]='employee.isAdmin'
              label='Местоположение'
              textSize='small'
              required='true'
          ></do-input>
          <do-select
              controlName='office'
              [isEdit]='employee.isAdmin'
              [options]='selectOptions.office'
              label='Офис'
              textSize='small'
              required='true'
          ></do-select>
          <ng-container *ngTemplateOutlet='emoji'></ng-container>
        </div>
        <div class='employee-info__second-column'>
          <ng-container *ngIf='canEdit()'>
            <ng-container *ngIf='!employee.isAdmin; else stepper'
            >
              <p doText regularTextSize='small' color='gray'>Ставка</p>
              <div>{{ employee.workingRate }}</div>
            </ng-container>
          </ng-container>
          <ng-container *ngIf='!employee.isAdmin; else hours'>
            <p doText regularTextSize='small' color='gray'>
              Рабочие часы
              <mat-icon
                  class='employee-info__hint'
                  aria-label='Hint'
                  matTooltipClass='tooltip'
                  matTooltip='Рабочие часы пользователя по вашему часовому поясу'
                  matTooltipPosition='above'
              >help_outline
              </mat-icon>
            </p>
            <div>{{ workingHours }}</div>
          </ng-container>
          <do-datepicker
              controlName='birthDate'
              [isEdit]='true'
              label='Дата рождения'
          ></do-datepicker>
          <do-datepicker
              controlName='workingSince'
              [isEdit]='employee.isAdmin'
              label='В компании с'
          ></do-datepicker>
          <ng-container *ngIf="employeeInfoForm.get('status').value === userStatus.Vacation">
            <do-datepicker
                controlName='vacationSince'
                [isEdit]='true'
                label='В отпуске с'
                required='true'
            ></do-datepicker>
            <do-datepicker
                controlName='vacationUntil'
                [isEdit]='true'
                label='В отпуске до'
                required='true'
            ></do-datepicker>
          </ng-container>
          <ng-container *ngIf="employeeInfoForm.get('status').value === userStatus.Sick">
            <do-datepicker
                controlName='sickSince'
                [isEdit]='true'
                label='На больничном с'
                required='true'
            ></do-datepicker>
          </ng-container>
        </div>
      </div>
    </div>
    <div class='employee-info__additional '>
      <div class='additional__line bg-light_3'></div>
      <div class='form__column'>
        <h4 doText color='dark_2'>Контакты</h4>
        <do-input
            controlName='email'
            [isEdit]='employee.isAdmin'
            label='E-mail'
            textSize='small'
            required='true'
        ></do-input>
        <do-input
            controlName='phone'
            [isEdit]='true'
            textSize='small'
            label='Рабочий номер'
            required='true'
        ></do-input>
        <do-input
            controlName='telegram'
            [isEdit]='true'
            textSize='small'
            label='Telegram'
        ></do-input>
        <ng-container *ngIf='canEdit()'>
          <h4 doText color='dark_2'>
            Отпуск
            <mat-icon
                class='employee-info__hint text-gray'
                aria-label='Hint'
                matTooltipClass='tooltip'
                matTooltip='Стандартный отпуск - 20 рабочих дней в год'
                matTooltipPosition='above'
            >help_outline
            </mat-icon
            >
          </h4>
          <do-input
              controlName='vacationDays'
              type='number'
              [isEdit]='employee.isAdmin'
              label='Осталось отпускных дней'
              textSize='small'
              required='true'
          ></do-input>
        </ng-container>
      </div>
    </div>
    <div class='employee-info__form-buttons'>
      <button type='button' class='text-gray' mat-flat-button (click)='onReset()'>Отменить</button>
      <button
          [disabled]='employeeInfoForm.invalid'
          type='submit'
          class='bg-accent_color_bright text-light_1 employee-info__submit'
          mat-flat-button
      >
        Сохранить
      </button>
      <div class='employee-info__required-block'><span doText color='negative_accent'>
      <sup>*</sup>&nbsp;Обязательное поле</span>
      </div>
    </div>
  </div></form>
</ng-template>
