<div class="employee-info regular_text text_dark_1">
	<ng-container *ngIf="user">
		<ng-container *ngIf="!canEdit() || !isEditing; else editForm">
			<div class="employee-info__wrapper">
				<div class="employee-info__main">
					<div class="employee-info__avatar">
						<do-profile-image [image]="user?.user?.avatar" size="l"></do-profile-image>
					</div>
					<h3 class="employee-info__name" doText color="dark_2">
						{{ user.getFioFull() }}&nbsp;<span
							matTooltipClass="tooltip"
							[matTooltip]="user.firstName + ' ' + (user.statusEmoji?.statusInRussian | lowercase)"
							[matTooltipPosition]="'above'"
							>{{ user.statusEmoji?.emojiIcon }}</span
						>
					</h3>
					<p *ngIf="user?.user?.about" doText color="gray" class="employee-info__about">“{{ user?.user?.about }}”</p>
				</div>
				<div class="employee-info__general">
					<h4 doText color="dark_2">Общие сведения</h4>
					<div class="employee-info__columns">
						<div class="employee-info__first-column">
							<div *ngIf="user?.user?.position">
								<p doText regularTextSize="small" color="gray">Должность</p>
								<p doText>{{ user.user.position.name }}</p>
							</div>
							<div *ngIf="user?.user?.department">
								<p doText regularTextSize="small" color="gray">Департамент</p>
								<p doText>{{ user.user.department?.name }}</p>
							</div>
							<div *ngIf="user?.user?.city">
								<p doText regularTextSize="small" color="gray">Местоположение</p>
								<p doText>{{ user?.user?.city }}</p>
							</div>
							<div *ngIf="user?.user?.office?.city">
								<p doText regularTextSize="small" color="gray">Офис</p>
								<p doText>{{ user?.user?.office?.city }}, {{ user?.user?.office?.address }}</p>
							</div>
						</div>
						<div class="employee-info__second-column">
							<ng-container *ngIf="user?.user?.rate">
								<p doText regularTextSize="small" color="gray">Ставка</p>
								<div doText>{{ user?.user?.rate }}</div>
							</ng-container>
							<ng-container>
								<p doText regularTextSize="small" color="gray">Пол</p>
								<div doText>{{ user?.gender?.genderInRussian }}</div>
							</ng-container>
							<div *ngIf="user?.user?.role?.name">
								<p doText regularTextSize="small" color="gray">Роль</p>
								<p doText>{{ user.user.role?.name }}</p>
							</div>
							<div *ngIf="user?.user.startWorkingAt">
								<p doText regularTextSize="small" color="gray">В компании с</p>
								<p doText>{{ user.startWorkingDate | date: dateType.FULL }}</p>
							</div>
							<div *ngIf="user?.user.dateOfBirth">
								<p doText regularTextSize="small" color="gray">Дата рождения</p>
								<p doText>{{ user?.user?.dateOfBirth | date: dateType.FULL }}</p>
							</div>
							<!--TODO: Change when API will be ready
            <p doText regularTextSize='small' color='gray'>
              Рабочие часы
              <mat-icon
                  class='employee-info__hint'
                  aria-label='Hint'
                  matTooltipClass='tooltip'
                  matTooltip='Рабочие часы пользователя по вашему часовому поясу'
                  matTooltipPosition='above'
              >help_outline
              </mat-icon>
            </p>
             <div>{{ workingHours }}</div>

             <ng-container *ngIf='user?.user?.status === userStatus.Vacation'>
               <div>
                 <p doText regularTextSize='small' color='gray'>В отпуске с</p>
                 <p doText>{{ employee?.vacationSince | date: dateType.FULL }}</p>
               </div>
               <div>
                 <p doText regularTextSize='small' color='gray'>В отпуске до</p>
                 <p doText>{{ employee?.vacationUntil | date: dateType.FULL }}</p>
               </div>
             </ng-container>
             <ng-template *ngIf='employee.status.statusType === userStatus.Sick'>
               <div>
                 <p doText regularTextSize='small' color='gray'>На больничном с</p>
                 <p doText>{{ employee?.sickSince | date: dateType.FULL }}</p>
               </div>
             </ng-template>-->
						</div>
					</div>
				</div>
				<div class="employee-info__additional">
					<div class="additional__line bg-light_3"></div>
					<div class="form__column">
						<h4 doText color="dark_2">Контакты</h4>
						<div class="employee-info__columns">
							<div>
								<div *ngFor="let communication of user?.communications">
									<p doText regularTextSize="small" color="gray">{{ communication.type }}</p>
									<p doText>{{ communication.value }}</p>
								</div>
							</div>
						</div>
						<!--  TODO: Change when API will be ready
           <h4 doText color='dark_2'>
             Отпуск
             <mat-icon
                 class='employee-info__hint text-gray'
                 aria-label='Hint'
                 aria-label='Hint'
                 matTooltipClass='tooltip'
                 matTooltip='Стандартный отпуск - 20 рабочих дней в год'
                 matTooltipPosition='above'
             >help_outline
             </mat-icon>
           </h4>

           <div>
             <p doText regularTextSize='small' color='gray'>Осталось отпускных дней</p>
             <div doText>{{ employee?.vacationDaysLeft }}</div>
           </div>-->
					</div>
				</div>
				<div class="employee-info__edit-button">
					<button type="button" mat-icon-button aria-label="Edit employee info" (click)="toggleEditMode()">
						<img src="../../../../../assets/svg/edit.svg" alt="Edit" />
					</button>
				</div>
			</div>
		</ng-container>
	</ng-container>
</div>

<ng-template #nameEdit [formGroup]="employeeInfoForm">
	<do-input controlName="lastName" [isEdit]="isEditing" label="Фамилия" textSize="small" required="true"></do-input>
	<do-input controlName="firstName" [isEdit]="isEditing" label="Имя" textSize="small" required="true"></do-input>
	<do-input controlName="middleName" [isEdit]="isEditing" label="Отчество" textSize="small"></do-input>
</ng-template>

<ng-template #about [formGroup]="employeeInfoForm">
	<ng-container *ngIf="user.isAdmin">
		<label class="small_text text-gray employee-info__label employee-info__label_for_textarea" for="about">
			<span
				>О себе <span>{{ employeeInfoForm.get('about').value.length }}/150</span></span
			></label
		>
		<mat-form-field class="employee-info__form-field" appearance="none">
			<textarea
				id="about"
				formControlName="about"
				matInput
				class="bg-light_2 employee-info__input"
				placeholder="Напишите немного о себе или оставьте заметку коллегам"
				maxlength="150"
				cdkTextareaAutosize="true"
				textSize="small"
			></textarea>
		</mat-form-field>
	</ng-container>
</ng-template>

<ng-template #stepper [formGroup]="employeeInfoForm">
	<mat-form-field class="employee-info__form-field mat-form-field__stepper" appearance="fill">
		<mat-label doText color="gray" regularTextSize="small">Ставка</mat-label>
		<button
			class="employee-info__stepper-button h2"
			mat-icon-button
			matPrefix
			type="button"
			(click)="changeWorkingRate(-0.25)"
			[disabled]="rate.value === '0'"
		>
			-
		</button>
		<input #rate id="rate" formControlName="rate" matInput class="bg-light_2 employee-info__input" type="number" readonly required />
		<button
			class="employee-info__stepper-button h2"
			mat-icon-button
			matSuffix
			type="button"
			(click)="changeWorkingRate(0.25)"
			[disabled]="rate.value === '1'"
		>
			+
		</button>
	</mat-form-field>
</ng-template>

<ng-template #hours [formGroup]="employeeInfoForm">
	<!--TODO: Replace when api will be ready
   <div
       style='display: flex; align-items: flex-start;'
       formGroupName="workingHours"
        matTooltipClass="tooltip"
        matTooltip="Рабочие часы пользователя по вашему часовому поясу"
        [matTooltipPosition]="'above'">
     <mat-form-field
       class="mat-form-field_default-select employee-info__form-field employee-info__working-hours"
       appearance="fill"
     >
       <mat-label doText color='gray' regularTextSize='small'>
         Рабочие часы
         <mat-icon
             class="employee-info__hint"
             aria-label="Hint"
         >help_outline</mat-icon
         ></mat-label>
       <mat-select
         class="employee-info__input"
         id="startAt"
         formControlName="startAt"
       >
         <mat-option
           class="employee-info__input"
           *ngFor="let option of selectOptions.workingHours"
           [value]="option"
         >
           {{ option }}
         </mat-option>
       </mat-select>
     </mat-form-field>
     <div style='align-self: center;'>—</div>
     <mat-form-field
       class="mat-form-field_default-select employee-info__form-field employee-info__working-hours"
       appearance="none"
     >
       <mat-select class="employee-info__input" formControlName="endAt">
         <mat-option
           class="employee-info__input"
           *ngFor="let option of selectOptions.workingHours"
           [value]="option"
         >
           {{ option }}
         </mat-option>
       </mat-select>
     </mat-form-field>
   </div>-->
</ng-template>

<ng-template #emoji [formGroup]="employeeInfoForm">
	<mat-form-field
		class="employee-info__form-field mat-form-field_default-select"
		appearance="fill"
		matTooltipClass="tooltip"
		matTooltip="Статус будет отображаться рядом с именем пользователя"
		[matTooltipPosition]="'above'"
	>
		<mat-label doText color="gray" regularTextSize="small" class="employee-info__label" for="status">
			Эмодзи-статус
			<mat-icon class="employee-info__hint">help_outline</mat-icon>
		</mat-label>
		<mat-select class="employee-info__input" id="status" formControlName="status" appearance="fill">
			<mat-option class="employee-info__input" *ngFor="let option of selectOptions.statuses" [value]="option.statusType">
				{{ option.emojiIcon }} {{ option.statusInRussian | titlecase }}
			</mat-option>
		</mat-select>
	</mat-form-field>
	<ng-container *ngIf="isEditing && employeeInfoForm.get('status').value === userStatus.Vacation">
		<label class="small_text text-gray">Замещает: </label>
		<span class="small_text text-gray employee-info__substitute">Назначить замещающего</span>
	</ng-container>
</ng-template>

<ng-template #editForm>
	<form class="employee-info__form" [formGroup]="employeeInfoForm" (ngSubmit)="onSubmit()">
		<div class="employee-info__wrapper">
			<div class="employee-info__main">
				<div class="employee-info__avatar">
					<do-profile-image [image]="employeeInfoForm.get('photo').value" size="l"></do-profile-image>
					<label class="text_white employee-info__label employee-info__upload-button" (click)="onOpenDialog()">
						<mat-icon class="employee-info__upload-icon">
							<img src="../../../../../assets/svg/arrow-upload-file.svg" alt="Upload photo" />
						</mat-icon>
						Обновить фото</label
					>
				</div>
				<ng-container *ngIf="!user.isAdmin; else nameEdit"
					>]
					<h3 class="employee-info__name" doText color="dark_2">
						{{ user.getFioFull() }}&nbsp;<span
							matTooltipClass="tooltip"
							[matTooltip]="user?.firstName + ' ' + (user?.statusEmoji?.statusInRussian | lowercase)"
							[matTooltipPosition]="'above'"
							>{{ user?.statusEmoji?.emojiIcon }}</span
						>
					</h3>
				</ng-container>
				<ng-container *ngTemplateOutlet="about"></ng-container>
			</div>
			<div class="employee-info__general">
				<h4 doText color="dark_2">Общие сведения</h4>
				<div class="employee-info__columns">
					<div class="employee-info__first-column">
						<mat-form-field class="employee-info__form-field mat-form-field_default-select" appearance="fill">
							<mat-label doText color="gray" regularTextSize="small" class="employee-info__label" for="position"> Должность </mat-label>
							<mat-select class="employee-info__input" id="position" formControlName="position" appearance="fill" required>
								<mat-option class="employee-info__input" *ngFor="let position of selectOptions.positions" [value]="position.id">
									{{ position.name }}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="employee-info__form-field mat-form-field_default-select" appearance="fill">
							<mat-label doText color="gray" regularTextSize="small" class="employee-info__label" for="department">
								Департамент
							</mat-label>
							<mat-select class="employee-info__input" id="department" formControlName="department" appearance="fill">
								<mat-option class="employee-info__input" *ngFor="let department of selectOptions.departments" [value]="department.id">
									{{ department.name }}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<do-input controlName="city" [isEdit]="true" label="Местоположение" textSize="small"></do-input>
						<mat-form-field class="employee-info__form-field mat-form-field_default-select" appearance="fill">
							<mat-label doText color="gray" regularTextSize="small" class="employee-info__label" for="office"> Офис </mat-label>
							<mat-select class="employee-info__input" id="office" formControlName="office" appearance="fill" required>
								<mat-option class="employee-info__input" *ngFor="let office of selectOptions.offices" [value]="office.id">
									{{ office.city }}, {{ office.address }}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<ng-container *ngTemplateOutlet="emoji"></ng-container>
					</div>
					<div class="employee-info__second-column">
						<ng-container *ngIf="canEdit()">
							<ng-container *ngIf="!user.isAdmin; else stepper">
								<p doText regularTextSize="small" color="gray">Ставка</p>
								<div>{{ user.user.rate }}</div>
							</ng-container>
						</ng-container>
						<!--						<ng-container *ngIf="false">-->
						<!--							<p doText regularTextSize="small" color="gray">-->
						<!--								Рабочие часы-->
						<!--								<mat-icon-->
						<!--									class="employee-info__hint"-->
						<!--									aria-label="Hint"-->
						<!--									matTooltipClass="tooltip"-->
						<!--									matTooltip="Рабочие часы пользователя по вашему часовому поясу"-->
						<!--									matTooltipPosition="above"-->
						<!--									>help_outline-->
						<!--								</mat-icon>-->
						<!--							</p>-->
						<!--							<div>{{ workingHours }}</div>-->
						<!--						</ng-container>-->
						<mat-form-field class="employee-info__form-field mat-form-field_default-select" appearance="fill">
							<mat-label doText color="gray" regularTextSize="small" class="employee-info__label" for="gender"> Пол </mat-label>
							<mat-select class="employee-info__input" id="gender" formControlName="gender" appearance="fill">
								<mat-option class="employee-info__input" *ngFor="let gender of genders" [value]="gender.genderType">
									{{ gender.genderInRussian }}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<mat-form-field class="employee-info__form-field mat-form-field_default-select" appearance="fill">
							<mat-label doText color="gray" regularTextSize="small" class="employee-info__label" for="role"> Роль </mat-label>
							<mat-select class="employee-info__input" id="role" formControlName="role" appearance="fill">
								<mat-option class="employee-info__input" *ngFor="let role of selectOptions.roles" [value]="role.id">
									{{ role.name }}
								</mat-option>
							</mat-select>
						</mat-form-field>
						<do-datepicker controlName="startWorkingAt" [isEdit]="user.isAdmin" label="В компании с"></do-datepicker>
						<do-datepicker controlName="dateOfBirth" [isEdit]="user.isAdmin" label="Дата рождения"></do-datepicker>
						<!--TODO: Change when api will be ready
           <ng-container *ngIf="employeeInfoForm.get('status').value === userStatus.Vacation">
             <do-datepicker
                 controlName='vacationSince'
                 [isEdit]='true'
                 label='В отпуске с'
                 required='true'
             ></do-datepicker>
             <do-datepicker
                 controlName='vacationUntil'
                 [isEdit]='true'
                 label='В отпуске до'
                 required='true'
             ></do-datepicker>
           </ng-container>
           <ng-container *ngIf="employeeInfoForm.get('status').value === userStatus.Sick">
             <do-datepicker
                 controlName='sickSince'
                 [isEdit]='true'
                 label='На больничном с'
                 required='true'
             ></do-datepicker>
           </ng-container>-->
					</div>
				</div>
			</div>
			<div class="employee-info__additional">
				<div class="additional__line bg-light_3"></div>
				<div class="form__column">
					<h4 doText color="dark_2">Контакты</h4>
                    <div class="employee-info__columns">
                        <div>
                            <div *ngFor="let communication of user?.communications">
                                <p doText regularTextSize="small" color="gray">{{ communication.type }}</p>
                                <p doText>{{ communication.value }}</p>
                            </div>
                        </div>
                    </div>
<!--					<div class="communications" formArrayName="communications">-->
<!--						<ng-container *ngFor="let communication of communications.controls; index as i">-->
<!--							<ng-container [formGroup]="communication">-->
<!--								<mat-form-field class="mat-form-field__form-control" appearance="fill" floatLabel="always">-->
<!--									<mat-label>{{ communication.get('type').value }}</mat-label>-->
<!--									<input matInput placeholder="Введите данные" formControlName="value" required />-->
<!--								</mat-form-field>-->
<!--							</ng-container>-->
<!--						</ng-container>-->
<!--					</div>-->
					<!--TODO: Change when api will be ready
         <do-input
             controlName='email'
             [isEdit]='user.isAdmin'
             label='E-mail'
             textSize='small'
             required='true'
         ></do-input>
         <do-input
             controlName='phone'
             [isEdit]='true'
             textSize='small'
             label='Рабочий номер'
             required='true'
         ></do-input>
         <do-input
             controlName='telegram'
             [isEdit]='true'
             textSize='small'
             label='Telegram'
         ></do-input>
         <ng-container *ngIf='canEdit()'>
           <h4 doText color='dark_2'>
             Отпуск
             <mat-icon
                 class='employee-info__hint text-gray'
                 aria-label='Hint'
                 matTooltipClass='tooltip'
                 matTooltip='Стандартный отпуск - 20 рабочих дней в год'
                 matTooltipPosition='above'
             >help_outline</mat-icon>
           </h4>
           <do-input
               controlName='vacationDays'
               type='number'
               [isEdit]='user.isAdmin'
               label='Осталось отпускных дней'
               textSize='small'
               required='true'
           ></do-input>
         </ng-container>-->
				</div>
			</div>
			<div class="employee-info__form-buttons">
				<button type="button" class="text-gray" mat-flat-button (click)="onReset()">Отменить</button>
				<button
					[disabled]="employeeInfoForm.invalid"
					type="submit"
					class="bg-accent_color_bright text-light_1 employee-info__submit"
					mat-flat-button
				>
					Сохранить
				</button>
				<div class="employee-info__required-block">
					<span doText color="negative_accent"> <sup>*</sup>&nbsp;Обязательное поле</span>
				</div>
			</div>
		</div>
	</form>
</ng-template>
