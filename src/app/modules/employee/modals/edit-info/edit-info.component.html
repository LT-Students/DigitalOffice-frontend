<h3 mat-dialog-title doUnderline underlinedSize="sm">Редактирование профиля</h3>

<ng-container *ngIf="user | async as user">

<div class="edit-info__header">
	<h4>Общие сведения</h4>
    <button mat-button (click)="onEdit(user)" *ngIf="!isEditMode">
        <span class="edit-info__edit-button mat-body-2 text-disabled">Редактировать </span>
        <img src="../../../../../assets/svg/edit.svg" alt="edit_info" />
    </button>
    <span class="text-alert" *ngIf="isEditMode"><sup>*</sup>&nbsp;Обязательные поля</span>
</div>

<mat-dialog-content class="edit-info__general" [ngClass]="isEditMode ? 'edit-info__general-template' : 'edit-info__general-page'">
	<ng-container *ngIf="!isEditMode; else editTemplate">
        <div class="edit-info__field">
            <span class="mat-body-2 text-secondary_default">Фамилия</span>
            <div>{{ user.lastName | placeholder }}</div>
        </div>
        <div class="edit-info__field">
            <span class="mat-body-2 text-secondary_default">Имя</span>
            <div>{{ user.firstName | placeholder }}</div>
        </div>
        <div class="edit-info__field">
            <span class="mat-body-2 text-secondary_default">Отчество</span>
            <div>{{ user.middleName | placeholder }}</div>
        </div>
        <div class="edit-info__field">
            <span class="mat-body-2 text-secondary_default">Дата рождения</span>
            <div>{{ user.dateOfBirth  | date: dateType.FULL | placeholder }}</div>
        </div>
        <div class="edit-info__field">
            <span class="mat-body-2 text-secondary_default">Время работы</span>
            <div>{{ user.businessHoursFromUtc | date: 'shortTime' | placeholder }} - {{ user.businessHoursToUtc | date: 'shortTime' | placeholder}}</div>
        </div>
        <div class="edit-info__field">
            <span class="mat-body-2 text-secondary_default">Эмодзи-статус</span>
            <div>{{ user.status | userStatus: true: true | capitalize: 1 | placeholder}}</div>
        </div>
        <div class="edit-info__field edit-info__two-columns">
            <span class="mat-body-2 text-secondary_default">О себе</span>
            <div>{{ user.about | placeholder }}</div>
        </div>
    </ng-container>
</mat-dialog-content>

</ng-container>

<ng-template #editTemplate [formGroup]="editForm">
    <do-form-row label="Фамилия">
        <mat-form-field
            [matTooltip]="editForm.controls[userPath.LAST_NAME].errors?.['name'] ? 'Фамилия может содержать только буквы, -, ` и пробел.\nФамилия не может начинаться и заканчиваться символами - и `' : ''"
            [matTooltipPosition]="'right'"
        >
            <input doTransformName matInput [formControlName]="userPath.LAST_NAME" placeholder="Фамилия" minlength="1" maxlength="45" required />
            <mat-error *ngIf="editForm.controls[userPath.LAST_NAME].errors?.['whitespace']"
            >Фамилия не может состоять только из пробелов!
            </mat-error>
        </mat-form-field>
    </do-form-row>
    <do-form-row label="Имя">
        <mat-form-field
            [matTooltip]="editForm.controls[userPath.FIRST_NAME].errors?.['name'] ? 'Имя может содержать только буквы, -, ` и пробел.\nИмя не может начинаться и заканчиваться символами - и `' : ''"
            [matTooltipPosition]="'right'"
        >
            <input doTransformName matInput [formControlName]="userPath.FIRST_NAME" placeholder="Имя" minlength="1" maxlength="45" required />
            <mat-error *ngIf="editForm.controls[userPath.FIRST_NAME].errors?.['whitespace']"
            >Имя не может состоять только из пробелов!
            </mat-error>
        </mat-form-field>
    </do-form-row>
    <do-form-row label="Отчество">
        <mat-form-field>
            <input doTransformName  matInput [formControlName]="userPath.MIDDLE_NAME" placeholder="Отчество" minlength="1" maxlength="45" />
            <mat-error *ngIf="editForm.controls[userPath.MIDDLE_NAME].errors?.['whitespace']"
            >Отчество не может состоять только из пробелов!
            </mat-error>
        </mat-form-field>
    </do-form-row>
    <do-form-row label="Дата рождения">
        <mat-form-field>
            <input matInput [formControlName]="userPath.DATE_OF_BIRTH" [matDatepicker]="dayOfBirth" placeholder="Дата рождения" />
                <mat-datepicker-toggle matSuffix [for]="dayOfBirth">
                    <mat-icon matDatepickerToggleIcon>date_range</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #dayOfBirth></mat-datepicker>
        </mat-form-field>
    </do-form-row>

    <do-form-row label="Время работы">
        <div class="edit-info__hours">
            <div class="edit-info__hours-input">
                <label>С</label>
                <mat-form-field>
                    <input matInput autofocus [formControlName]="userPath.BUSINESS_HOURS_FROM_UTC" type="time" />
                    <mat-icon matSuffix>schedule</mat-icon>
                </mat-form-field>
            </div>
            <div class="edit-info__hours-input">
                <label>По</label>
                <mat-form-field>
                    <input matInput autofocus [formControlName]="userPath.BUSINESS_HOURS_TO_UTC" type="time" />
                    <mat-icon matSuffix>schedule</mat-icon>
                </mat-form-field>
            </div>
        </div>
    </do-form-row>

    <do-form-row label="Эмодзи-статус">
        <mat-form-field>
            <mat-select [formControlName]="userPath.STATUS">
                <mat-option *ngFor="let status of statuses" [value]="status.statusType">
                    {{ status.statusType | userStatus: true: true | capitalize: 1 }}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </do-form-row>

    <do-form-row label="О себе" class="edit-info__two-columns">
        <mat-form-field appearance="outline">
            <textarea
                #about
                matInput
                autocomplete="off"
                placeholder="Написать..."
                maxlength="{{ MAX_ABOUT_LENGTH }}"
                cdkTextareaAutosize="true"
                [formControlName]="userPath.ABOUT"
                cdkAutosizeMinRows="4"
                cdkAutosizeMaxRows="4"
            ></textarea>
            <mat-hint align="start">{{ about.value.length }}/{{ MAX_ABOUT_LENGTH }}</mat-hint>
        </mat-form-field>
    </do-form-row>

    <div class="edit-info__buttons edit-info__two-columns">
		<button mat-button (click)="toggleEditMode()" class="edit-info__button">Отменить</button>
		<button
			mat-flat-button
			type="submit"
			[disabled]="editForm.invalid"
			color="primary"
			(click)="onSubmit()"
			class="edit-info__button"
		>
			Сохранить
		</button>
	</div>
</ng-template>
