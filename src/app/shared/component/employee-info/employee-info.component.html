<div class="employee-info card regular_text text_dark_1">
  <form
    class="employee-info__form"
    [formGroup]="employeeInfoForm"
    (ngSubmit)="onSubmit()"
    (reset)="toggleEditMode()"
  >
    <div class="employee-info__main">
      <div class="employee-info__photo">
        <ng-container *ngIf="!isEditable; else photo">
          <img src="{{ employee.photo }}" alt="Employee photo" width="200" />
        </ng-container>
      </div>
      <ng-container *ngIf="!(employee.isAdmin && isEditable); else nameEdit">
        <h1 class="employee-info__name h3 text-dark_2">
          {{ fullName }}&nbsp;<span
            matTooltipClass="tooltip"
            matTooltip="Ангелина {{
              employee.emojiStatus.description | lowercase
            }}"
            [matTooltipPosition]="'above'"
            >{{ employee.emojiStatus.emoji }}</span
          >
        </h1>
      </ng-container>
      <ng-container *ngIf="!isEditable; else aboutMe">
        <div
          *ngIf="employee.aboutMe"
          class="employee-info__about-me small_text text-gray"
        >
          “{{ employee.aboutMe }}”
        </div>
      </ng-container>
    </div>
    <div class="employee-info__general">
      <h2 class="h4 text-dark_2">Общие сведения</h2>
      <div class="employee-info__columns">
        <div class="employee-info__first-column">
          <do-select
            controlName="jobPosition"
            [isEdit]="isEditable && employee.isAdmin"
            [options]="selectOptions.jobPosition"
            label="Должность"
            required="true"
          ></do-select>
          <do-select
            controlName="department"
            [isEdit]="isEditable && employee.isAdmin"
            [options]="selectOptions.department"
            label="Департамент"
            required="true"
          ></do-select>
          <do-input
            controlName="location"
            [isEdit]="isEditable && employee.isAdmin"
            label="Местоположение"
            required="true"
          ></do-input>
          <do-select
            controlName="office"
            [isEdit]="isEditable && employee.isAdmin"
            [options]="selectOptions.office"
            label="Офис"
            required="true"
          ></do-select>
          <ng-container *ngIf="isEditable; then emoji"></ng-container>
        </div>
        <div class="employee-info__second-column">
          <ng-container *ngIf="isVisitor()">
            <ng-container
              *ngIf="!employee.isAdmin || !isEditable; else stepper"
            >
              <h3 class="small_text text-gray">Ставка</h3>
              <div>{{ employee.workingRate }}</div>
            </ng-container>
          </ng-container>
          <ng-container *ngIf="!employee.isAdmin || !isEditable; else hours">
            <h3 class="small_text text-gray">
              Рабочие часы
              <mat-icon
                class="employee-info__hint"
                aria-label="Hint"
                matTooltipClass="tooltip"
                matTooltip="Рабочие часы пользователя по вашему часовому поясу"
                [matTooltipPosition]="'above'"
                >help_outline
              </mat-icon>
            </h3>
            <div>{{ workingHours }}</div>
          </ng-container>
          <do-datepicker
            controlName="workingSince"
            [isEdit]="isEditable && employee.isAdmin"
            label="В компании с"
            format="LLLL y"
          ></do-datepicker>
          <do-datepicker
            controlName="birthDate"
            [isEdit]="isEditable"
            label="Дата рождения"
          ></do-datepicker>
          <ng-container *ngIf="isEditable">
            <do-datepicker
              controlName="vacationSince"
              [isEdit]="isEditable"
              label="В отпуске с"
              required="true"
            ></do-datepicker>
            <do-datepicker
              controlName="vacationUntil"
              [isEdit]="isEditable"
              label="В отпуске до"
              required="true"
            ></do-datepicker>
          </ng-container>
        </div>
      </div>
      <ng-container *ngIf="isEditable; then submitButtons"></ng-container>
    </div>
    <div class="employee-info__additional bg-light_1">
      <h2 class="h4 text-dark_2">Контакты</h2>
      <do-input
        controlName="email"
        [isEdit]="isEditable && employee.isAdmin"
        label="E-mail"
        required="true"
      ></do-input>
      <do-input
        controlName="phone"
        [isEdit]="isEditable"
        label="Рабочий номер"
        required="true"
      ></do-input>
      <do-input
        controlName="telegram"
        [isEdit]="isEditable"
        label="Telegram"
      ></do-input>
      <ng-container *ngIf="isVisitor()">
        <h2 class="h4 text-dark_2">
          Отпуск
          <mat-icon
            class="employee-info__hint text-gray"
            aria-label="Hint"
            matTooltipClass="tooltip"
            matTooltip="Стандартный отпуск - 20 рабочих дней в год"
            [matTooltipPosition]="'above'"
            >help_outline</mat-icon
          >
        </h2>
        <do-input
          controlName="vacationDays"
          type="number"
          [isEdit]="isEditable && employee.isAdmin"
          label="Осталось отпускных дней"
          required="true"
        ></do-input>
        <div class="employee-info__edit-button bg-light_1">
          <button
            type="button"
            mat-icon-button
            aria-label="Edit employee info"
            (click)="toggleEditMode()"
          >
            <mat-icon aria-label="Edit">
              <img src="assets/svg/edit.svg" alt="Edit" height="20px" />
            </mat-icon>
          </button>
        </div>
      </ng-container>
    </div>
  </form>
</div>

<ng-template #nameEdit [formGroup]="employeeInfoForm">
  <do-input
    controlName="lastName"
    [isEdit]="isEditable"
    label="Фамилия"
    required="true"
  ></do-input>
  <do-input
    controlName="firstName"
    [isEdit]="isEditable"
    label="Имя"
    required="true"
  ></do-input>
  <do-input
    controlName="middleName"
    [isEdit]="isEditable"
    label="Отчество"
  ></do-input>
</ng-template>

<ng-template #aboutMe [formGroup]="employeeInfoForm">
  <ng-container *ngIf="!employee.isAdmin">
    <label
      class="small_text text-gray employee-info__label employee-info__label_for_textarea"
      for="aboutMe"
      ><span>О себе</span
      ><span>{{ employeeInfoForm.value.aboutMe.length }}/150</span></label
    >
    <mat-form-field class="employee-info__form-field" appearance="none">
      <textarea
        id="aboutMe"
        formControlName="aboutMe"
        matInput
        class="bg-light_2 employee-info__input"
        placeholder="Напишите немного о себе или оставьте заметку коллегам"
        maxlength="150"
        cdkTextareaAutosize="false"
      ></textarea>
    </mat-form-field>
  </ng-container>
</ng-template>

<ng-template #stepper [formGroup]="employeeInfoForm">
  <label class="small_text text-gray employee-info__label" for="workingRate"
    >Ставка<sup class="employee-info__required">*</sup></label
  >
  <mat-form-field
    class="employee-info__form-field employee-info__stepper"
    appearance="fill"
  >
    <button
      class="employee-info__stepper-button h2"
      mat-icon-button
      matPrefix
      type="button"
      (click)="changeWorkingRate(rate.value, -0.25)"
      [disabled]="+rate.value === 0"
    >
      -
    </button>
    <input
      #rate
      id="workingRate"
      formControlName="workingRate"
      matInput
      class="bg-light_2 employee-info__input"
      type="number"
      readonly
    />
    <button
      class="employee-info__stepper-button h2"
      mat-icon-button
      matSuffix
      type="button"
      (click)="changeWorkingRate(rate.value, 0.25)"
      [disabled]="+rate.value === 1"
    >
      +
    </button>
  </mat-form-field>
</ng-template>

<ng-template #hours [formGroup]="employeeInfoForm">
  <label class="small_text text-gray employee-info__label" for="startAt">
    Рабочие часы
    <mat-icon
      class="employee-info__hint"
      aria-label="Hint"
      matTooltipClass="tooltip"
      matTooltip="Рабочие часы пользователя по вашему часовому поясу"
      [matTooltipPosition]="'above'"
      >help_outline</mat-icon
    >
  </label>
  <div formGroupName="workingHours">
    <mat-form-field
      class="mat-form-field_default-select employee-info__form-field employee-info__working-hours"
      appearance="none"
    >
      <mat-select
        class="employee-info__input"
        id="startAt"
        formControlName="startAt"
      >
        <mat-option
          class="employee-info__input"
          *ngFor="let option of selectOptions.workingHours"
          [value]="option"
        >
          {{ option }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    —
    <mat-form-field
      class="mat-form-field_default-select employee-info__form-field employee-info__working-hours"
      appearance="none"
    >
      <mat-select class="employee-info__input" formControlName="endAt">
        <mat-option
          class="employee-info__input"
          *ngFor="let option of selectOptions.workingHours"
          [value]="option"
        >
          {{ option }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</ng-template>

<ng-template #photo [formGroup]="employeeInfoForm">
  <img [src]="previewPhoto" alt="Employee photo" width="200" />
  <label
    class="text_white employee-info__label employee-info__upload-button"
    for="photo"
    ><mat-icon class="employee-info__upload-icon">
      <img src="assets/svg/arrow-upload-file.svg" alt="Upload photo" />
    </mat-icon>
    Обновить фото</label
  >
  <input
    id="photo"
    type="file"
    formGroupName="photo"
    (change)="onFileChange($event)"
    hidden
  />
</ng-template>

<ng-template #emoji [formGroup]="employeeInfoForm">
  <label class="small_text text-gray employee-info__label" for="emojiStatus">
    Эмодзи-статус
    <mat-icon
      class="employee-info__hint"
      aria-label="Hint"
      matTooltipClass="tooltip"
      matTooltip="Статус будет отображаться рядом с именем пользователя"
      [matTooltipPosition]="'above'"
      >help_outline</mat-icon
    >
  </label>
  <mat-form-field
    class="employee-info__form-field mat-form-field_default-select"
    appearance="none"
  >
    <mat-select
      class="employee-info__input"
      id="emojiStatus"
      formControlName="emojiStatus"
      [compareWith]="compareEmoji"
    >
      <mat-option
        class="employee-info__input"
        *ngFor="let option of selectOptions.emojiStatus"
        [value]="option"
      >
        {{ option.emoji }} {{ option.description }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <label class="small_text text-gray">Замещает: </label>
  <span class="small_text text-gray employee-info__substitute"
    >Назначить замещающего</span
  >
</ng-template>

<ng-template #submitButtons [formGroup]="employeeInfoForm">
  <div class="employee-info__form-buttons">
    <button type="reset" class="text-gray" mat-flat-button>Отменить</button>
    <button
      [disabled]="employeeInfoForm.invalid"
      type="submit"
      class="bg-accent_color_bright text-light_1 employee-info__submit"
      mat-flat-button
    >
      Сохранить
    </button>
  </div>
</ng-template>
